{"version":3,"sources":["../../client/page-loader.ts"],"names":["looseToArray","input","slice","call","hasRel","rel","link","document","createElement","relList","supports","pageLoadError","route","Error","INITIAL_CSS_LOAD_ERROR","Symbol","relPrefetch","relPreload","relPreloadStyle","hasNoModule","normalizeRoute","replace","appendLink","href","as","Promise","res","rej","crossOrigin","process","env","__NEXT_CROSS_ORIGIN","onload","onerror","head","appendChild","loadScript","url","script","__NEXT_MODERN_BUILD","type","src","body","PageLoader","constructor","buildId","assetPrefix","initialPage","pageCache","pageRegisterEvents","loadingRoutes","promisedBuildManifest","promisedSsgManifest","promisedDevPagesManifest","resolve","window","__BUILD_MANIFEST","__BUILD_MANIFEST_CB","__SSG_MANIFEST","__SSG_MANIFEST_CB","getPageList","NODE_ENV","then","buildManifest","sortedPages","__DEV_PAGES_MANIFEST","pages","fetch","json","manifest","catch","err","console","log","getDependencies","m","map","encodeURI","reject","getDataHref","asPath","ssg","locale","pathname","hrefPathname","query","search","asPathname","getHrefForSlug","path","dataRoute","isDynamic","interpolatedRoute","result","prefetchData","s","_dataHref","has","querySelector","loadPage","cachedPage","error","fire","pageToCache","off","on","deps","pending","forEach","d","endsWith","push","all","scriptRoute","registerPage","regFn","register","styleSheets","mod","pageData","page","default","emit","module","hot","status","check","removeStatusHandler","fetchStyleSheet","ok","text","isInitialLoad","promisedDeps","querySelectorAll","e","getAttribute","filter","cssFiles","Object","defineProperty","prefetch","isDependency","cn","navigator","connection","saveData","test","effectiveType","ext","encodeURIComponent","urls","dependencyUrl"],"mappings":"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","sourcesContent":["import { ComponentType } from 'react'\nimport type { ClientSsgManifest } from '../build'\nimport type { ClientBuildManifest } from '../build/webpack/plugins/build-manifest-plugin'\nimport type { MittEmitter } from '../next-server/lib/mitt'\nimport mitt from '../next-server/lib/mitt'\nimport {\n  addBasePath,\n  addLocale,\n  interpolateAs,\n  markLoadingError,\n} from '../next-server/lib/router/router'\nimport getAssetPathFromRoute from '../next-server/lib/router/utils/get-asset-path-from-route'\nimport { isDynamicRoute } from '../next-server/lib/router/utils/is-dynamic'\nimport { parseRelativeUrl } from '../next-server/lib/router/utils/parse-relative-url'\n\nexport const looseToArray = <T extends {}>(input: any): T[] =>\n  [].slice.call(input)\n\nfunction hasRel(rel: string, link?: HTMLLinkElement) {\n  try {\n    link = document.createElement('link')\n    return link.relList.supports(rel)\n  } catch {}\n}\n\nfunction pageLoadError(route: string) {\n  return markLoadingError(new Error(`Error loading ${route}`))\n}\n\nexport const INITIAL_CSS_LOAD_ERROR = Symbol('INITIAL_CSS_LOAD_ERROR')\n\nconst relPrefetch =\n  hasRel('preload') && !hasRel('prefetch')\n    ? // https://caniuse.com/#feat=link-rel-preload\n      // macOS and iOS (Safari does not support prefetch)\n      'preload'\n    : // https://caniuse.com/#feat=link-rel-prefetch\n      // IE 11, Edge 12+, nearly all evergreen\n      'prefetch'\n\nconst relPreload = hasRel('preload') ? 'preload' : relPrefetch\nconst relPreloadStyle = 'fetch'\n\nconst hasNoModule = 'noModule' in document.createElement('script')\n\nfunction normalizeRoute(route: string) {\n  if (route[0] !== '/') {\n    throw new Error(`Route name should start with a \"/\", got \"${route}\"`)\n  }\n\n  if (route === '/') return route\n  return route.replace(/\\/$/, '')\n}\n\nfunction appendLink(\n  href: string,\n  rel: string,\n  as?: string,\n  link?: HTMLLinkElement\n): Promise<any> {\n  return new Promise((res, rej) => {\n    link = document.createElement('link')\n\n    // The order of property assignment here is intentional:\n    if (as) link!.as = as\n    link!.rel = rel\n    link!.crossOrigin = process.env.__NEXT_CROSS_ORIGIN!\n    link!.onload = res\n    link!.onerror = rej\n\n    // `href` should always be last:\n    link!.href = href\n\n    document.head.appendChild(link)\n  })\n}\n\nfunction loadScript(url: string): Promise<any> {\n  return new Promise((res, rej) => {\n    const script = document.createElement('script')\n    if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n      script.type = 'module'\n    }\n    script.crossOrigin = process.env.__NEXT_CROSS_ORIGIN!\n    script.src = url\n    script.onload = res\n    script.onerror = () => rej(pageLoadError(url))\n    document.body.appendChild(script)\n  })\n}\n\nexport type StyleSheetTuple = { href: string; text: string }\nexport type GoodPageCache = {\n  page: ComponentType\n  mod: any\n  styleSheets: StyleSheetTuple[]\n}\nexport type PageCacheEntry = { error: any } | GoodPageCache\n\nexport default class PageLoader {\n  private initialPage: string\n  private buildId: string\n  private assetPrefix: string\n  private pageCache: Record<string, PageCacheEntry>\n  private pageRegisterEvents: MittEmitter\n  private loadingRoutes: Record<string, boolean>\n  private promisedBuildManifest?: Promise<ClientBuildManifest>\n  private promisedSsgManifest?: Promise<ClientSsgManifest>\n  private promisedDevPagesManifest?: Promise<any>\n\n  constructor(buildId: string, assetPrefix: string, initialPage: string) {\n    this.initialPage = initialPage\n\n    this.buildId = buildId\n    this.assetPrefix = assetPrefix\n\n    this.pageCache = {}\n    this.pageRegisterEvents = mitt()\n    this.loadingRoutes = {\n      // By default these 2 pages are being loaded in the initial html\n      '/_app': true,\n    }\n\n    // TODO: get rid of this limitation for rendering the error page\n    if (initialPage !== '/_error') {\n      this.loadingRoutes[initialPage] = true\n    }\n\n    this.promisedBuildManifest = new Promise((resolve) => {\n      if ((window as any).__BUILD_MANIFEST) {\n        resolve((window as any).__BUILD_MANIFEST)\n      } else {\n        ;(window as any).__BUILD_MANIFEST_CB = () => {\n          resolve((window as any).__BUILD_MANIFEST)\n        }\n      }\n    })\n\n    /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise((resolve) => {\n      if ((window as any).__SSG_MANIFEST) {\n        resolve((window as any).__SSG_MANIFEST)\n      } else {\n        ;(window as any).__SSG_MANIFEST_CB = () => {\n          resolve((window as any).__SSG_MANIFEST)\n        }\n      }\n    })\n  }\n\n  getPageList() {\n    if (process.env.NODE_ENV === 'production') {\n      return this.promisedBuildManifest!.then(\n        (buildManifest) => buildManifest.sortedPages\n      )\n    } else {\n      if ((window as any).__DEV_PAGES_MANIFEST) {\n        return (window as any).__DEV_PAGES_MANIFEST.pages\n      } else {\n        if (!this.promisedDevPagesManifest) {\n          this.promisedDevPagesManifest = fetch(\n            `${this.assetPrefix}/_next/static/development/_devPagesManifest.json`\n          )\n            .then((res) => res.json())\n            .then((manifest) => {\n              ;(window as any).__DEV_PAGES_MANIFEST = manifest\n              return manifest.pages\n            })\n            .catch((err) => {\n              console.log(`Failed to fetch devPagesManifest`, err)\n            })\n        }\n        return this.promisedDevPagesManifest\n      }\n    }\n  }\n\n  // Returns a promise for the dependencies for a particular route\n  private getDependencies(route: string): Promise<string[]> {\n    return this.promisedBuildManifest!.then((m) => {\n      return m[route]\n        ? m[route].map((url) => `${this.assetPrefix}/_next/${encodeURI(url)}`)\n        : Promise.reject(pageLoadError(route))\n    })\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  getDataHref(\n    href: string,\n    asPath: string,\n    ssg: boolean,\n    locale?: string | false\n  ) {\n    const { pathname: hrefPathname, query, search } = parseRelativeUrl(href)\n    const { pathname: asPathname } = parseRelativeUrl(asPath)\n    const route = normalizeRoute(hrefPathname)\n\n    const getHrefForSlug = (path: string) => {\n      const dataRoute = addLocale(getAssetPathFromRoute(path, '.json'), locale)\n      return addBasePath(\n        `/_next/data/${this.buildId}${dataRoute}${ssg ? '' : search}`\n      )\n    }\n\n    const isDynamic: boolean = isDynamicRoute(route)\n    const interpolatedRoute = isDynamic\n      ? interpolateAs(hrefPathname, asPathname, query).result\n      : ''\n\n    return isDynamic\n      ? interpolatedRoute && getHrefForSlug(interpolatedRoute)\n      : getHrefForSlug(route)\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  prefetchData(href: string, asPath: string, locale?: string | false) {\n    const { pathname: hrefPathname } = parseRelativeUrl(href)\n    const route = normalizeRoute(hrefPathname)\n    return this.promisedSsgManifest!.then(\n      (s: ClientSsgManifest, _dataHref?: string) =>\n        // Check if the route requires a data file\n        s.has(route) &&\n        // Try to generate data href, noop when falsy\n        (_dataHref = this.getDataHref(href, asPath, true, locale)) &&\n        // noop when data has already been prefetched (dedupe)\n        !document.querySelector(\n          `link[rel=\"${relPrefetch}\"][href^=\"${_dataHref}\"]`\n        ) &&\n        // Inject the `<link rel=prefetch>` tag for above computed `href`.\n        appendLink(_dataHref, relPrefetch, 'fetch').catch(() => {\n          /* ignore prefetch error */\n        })\n    )\n  }\n\n  loadPage(route: string): Promise<GoodPageCache> {\n    route = normalizeRoute(route)\n\n    return new Promise<GoodPageCache>((resolve, reject) => {\n      // If there's a cached version of the page, let's use it.\n      const cachedPage = this.pageCache[route]\n      if (cachedPage) {\n        if ('error' in cachedPage) {\n          reject(cachedPage.error)\n        } else {\n          resolve(cachedPage)\n        }\n        return\n      }\n\n      const fire = (pageToCache: PageCacheEntry) => {\n        this.pageRegisterEvents.off(route, fire)\n        delete this.loadingRoutes[route]\n\n        if ('error' in pageToCache) {\n          reject(pageToCache.error)\n        } else {\n          resolve(pageToCache)\n        }\n      }\n\n      // Register a listener to get the page\n      this.pageRegisterEvents.on(route, fire)\n\n      if (!this.loadingRoutes[route]) {\n        this.loadingRoutes[route] = true\n        if (process.env.NODE_ENV === 'production') {\n          this.getDependencies(route)\n            .then((deps) => {\n              const pending: Promise<any>[] = []\n              deps.forEach((d) => {\n                if (\n                  d.endsWith('.js') &&\n                  !document.querySelector(`script[src^=\"${d}\"]`)\n                ) {\n                  pending.push(loadScript(d))\n                }\n\n                // Prefetch CSS as it'll be needed when the page JavaScript\n                // evaluates. This will only trigger if explicit prefetching is\n                // disabled for a <Link>... prefetching in this case is desirable\n                // because we *know* it's going to be used very soon (page was\n                // loaded).\n                if (\n                  d.endsWith('.css') &&\n                  !document.querySelector(\n                    `link[rel=\"${relPreload}\"][href^=\"${d}\"]`\n                  )\n                ) {\n                  // This is not pushed into `pending` because we don't need to\n                  // wait for these to resolve. To prevent an unhandled\n                  // rejection, we swallow the error which is handled later in\n                  // the rendering cycle (this is just a preload optimization).\n                  appendLink(d, relPreload, relPreloadStyle).catch(() => {\n                    /* ignore preload error */\n                  })\n                }\n              })\n              return Promise.all(pending)\n            })\n            .catch((err) => {\n              // Mark the page as failed to load if any of its required scripts\n              // fail to load:\n              this.pageCache[route] = { error: err }\n              fire({ error: err })\n            })\n        } else {\n          // Development only. In production the page file is part of the build manifest\n          route = normalizeRoute(route)\n          let scriptRoute = getAssetPathFromRoute(route, '.js')\n\n          const url = `${this.assetPrefix}/_next/static/chunks/pages${encodeURI(\n            scriptRoute\n          )}`\n          loadScript(url).catch((err) => {\n            // Mark the page as failed to load if its script fails to load:\n            this.pageCache[route] = { error: err }\n            fire({ error: err })\n          })\n        }\n      }\n    })\n  }\n\n  // This method if called by the route code.\n  registerPage(route: string, regFn: () => any) {\n    const register = async (styleSheets: StyleSheetTuple[]) => {\n      try {\n        const mod = await regFn()\n        const pageData: PageCacheEntry = {\n          page: mod.default || mod,\n          mod,\n          styleSheets,\n        }\n        this.pageCache[route] = pageData\n        this.pageRegisterEvents.emit(route, pageData)\n      } catch (error) {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Wait for webpack to become idle if it's not.\n      // More info: https://github.com/vercel/next.js/pull/1511\n      if ((module as any).hot && (module as any).hot.status() !== 'idle') {\n        console.log(\n          `Waiting for webpack to become \"idle\" to initialize the page: \"${route}\"`\n        )\n\n        const check = (status: string) => {\n          if (status === 'idle') {\n            ;(module as any).hot.removeStatusHandler(check)\n            register(\n              /* css is handled via style-loader in development */\n              []\n            )\n          }\n        }\n        ;(module as any).hot.status(check)\n        return\n      }\n    }\n\n    function fetchStyleSheet(href: string): Promise<StyleSheetTuple> {\n      return fetch(href).then((res) => {\n        if (!res.ok) throw pageLoadError(href)\n        return res.text().then((text) => ({ href, text }))\n      })\n    }\n\n    const isInitialLoad = route === this.initialPage\n    const promisedDeps: Promise<StyleSheetTuple[]> =\n      // Shared styles will already be on the page:\n      route === '/_app' ||\n      // We use `style-loader` in development:\n      process.env.NODE_ENV !== 'production'\n        ? Promise.resolve([])\n        : // Tests that this does not block hydration:\n          // test/integration/css-fixtures/hydrate-without-deps/\n          (isInitialLoad\n            ? Promise.resolve(\n                looseToArray<HTMLLinkElement>(\n                  document.querySelectorAll('link[data-n-p]')\n                ).map((e) => e.getAttribute('href')!)\n              )\n            : this.getDependencies(route).then((deps) =>\n                deps.filter((d) => d.endsWith('.css'))\n              )\n          ).then((cssFiles) =>\n            // These files should've already been fetched by now, so this\n            // should resolve instantly.\n            Promise.all(cssFiles.map((d) => fetchStyleSheet(d))).catch(\n              (err) => {\n                if (isInitialLoad) {\n                  Object.defineProperty(err, INITIAL_CSS_LOAD_ERROR, {})\n                }\n                throw err\n              }\n            )\n          )\n    promisedDeps.then(\n      (deps) => register(deps),\n      (error) => {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    )\n  }\n\n  /**\n   * @param {string} route\n   * @param {boolean} [isDependency]\n   */\n  prefetch(route: string, isDependency?: boolean): Promise<void> {\n    // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n    // License: Apache 2.0\n    let cn\n    if ((cn = (navigator as any).connection)) {\n      // Don't prefetch if using 2G or if Save-Data is enabled.\n      if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve()\n    }\n\n    /** @type {string} */\n    let url\n    if (isDependency) {\n      url = route\n    } else {\n      if (process.env.NODE_ENV !== 'production') {\n        route = normalizeRoute(route)\n\n        const ext =\n          process.env.__NEXT_MODERN_BUILD && hasNoModule ? '.module.js' : '.js'\n        const scriptRoute = getAssetPathFromRoute(route, ext)\n\n        url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n          this.buildId\n        )}/pages${encodeURI(scriptRoute)}`\n      }\n    }\n\n    return Promise.all(\n      document.querySelector(`link[rel=\"${relPrefetch}\"][href^=\"${url}\"]`)\n        ? []\n        : [\n            url &&\n              appendLink(\n                url,\n                relPrefetch,\n                url.endsWith('.css') ? relPreloadStyle : 'script'\n              ),\n            process.env.NODE_ENV === 'production' &&\n              !isDependency &&\n              this.getDependencies(route).then((urls) =>\n                Promise.all(\n                  urls.map((dependencyUrl) =>\n                    this.prefetch(dependencyUrl, true)\n                  )\n                )\n              ),\n          ]\n    ).then(\n      // do not return any data\n      () => {},\n      // swallow prefetch errors\n      () => {}\n    )\n  }\n}\n"]}